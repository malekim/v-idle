import{defineComponent as e,ref as n,onMounted as t,nextTick as a,onBeforeUnmount as r,h as u}from"vue-demi";var l=e({emits:["idle","remind","refresh"],props:{duration:{type:Number,default:300},events:{type:Array,default:function(){return["mousemove","keypress"]}},loop:{type:Boolean,default:!1},syncKey:{type:String,default:""},reminders:{type:Array,default:function(){return[]}},wait:{type:Number,default:0}},setup:function(e,u){var l=u.emit,o=n(""),v=n(void 0),i=n(0),d=n(void 0),s=n(0),c=n(""),f=n(""),y=n(void 0),p=e.syncKey.length>0&&"undefined"!=typeof window&&"BroadcastChannel"in window,w=function(){if(s.value=e.duration-((Date.now()-i.value)/1e3|0),s.value<0&&!e.loop)return clearInterval(v.value),void clearInterval(d.value);e.reminders.length>0&&e.reminders.includes(s.value)&&I();var n=s.value/60|0,t=s.value%60|0;c.value="".concat(n<10?"0"+n:n),f.value="".concat(t<10?"0"+t:t),o.value="".concat(c.value,":").concat(f.value)},m=function(){w(),s.value<=0&&e.loop&&(i.value=Date.now()+1e3)},h=function(){l("idle")},I=function(){l("remind")},g=function(){v.value=window.setInterval(h,1e3*e.duration),d.value=window.setInterval(m,1e3)},D=function(e){var n={type:e.type,key:e instanceof KeyboardEvent?e.key:void 0};E(n),p&&K(n)},E=function(e){l("refresh",e),clearInterval(v.value),clearInterval(d.value),w(),i.value=Date.now(),s.value=0,g()},K=function(e){void 0!==y.value&&y.value.postMessage(e)};return t((function(){p&&(y.value=new BroadcastChannel(e.syncKey),y.value.addEventListener("message",(function(e){E(e.data)}))),setTimeout((function(){i.value=Date.now(),w(),a((function(){g();for(var n=e.events.length-1;n>=0;n-=1)window.addEventListener(e.events[n],D)}))}),1e3*e.wait)})),r((function(){clearInterval(v.value),clearInterval(d.value);for(var n=e.events.length-1;n>=0;n-=1)window.removeEventListener(e.events[n],D)})),{display:o}},render:function(){return u("div",{class:"v-idle"},this.display)}});export{l as default};
//# sourceMappingURL=vidle.esm.min.js.map
