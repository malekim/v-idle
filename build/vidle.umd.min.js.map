{"version":3,"file":"vidle.umd.min.js","sources":["../src/components/vidle.ts"],"sourcesContent":["import {\n  h,\n  nextTick,\n  ref,\n  defineComponent,\n  type PropType,\n  type Ref,\n  onMounted,\n  onBeforeUnmount,\n} from 'vue-demi'\n\nexport default defineComponent({\n  emits: ['idle', 'remind', 'refresh'],\n  props: {\n    duration: {\n      type: Number,\n      // default 5 minutes\n      default: 60 * 5,\n    },\n    events: {\n      type: Array as PropType<string[]>,\n      default: (): string[] => ['mousemove', 'keypress'],\n    },\n    loop: {\n      type: Boolean,\n      default: false,\n    },\n    reminders: {\n      type: Array as PropType<number[]>,\n      // array of seconds\n      // emit \"remind\" event on each second\n      default: (): number[] => [],\n    },\n    wait: {\n      type: Number,\n      default: 0,\n    },\n  },\n  setup: (props, { emit }) => {\n    const display: Ref<string> = ref('ed')\n    const timer: Ref<number | undefined> = ref(undefined)\n    const start: Ref<number> = ref(0)\n    const counter: Ref<number | undefined> = ref(undefined)\n    const diff: Ref<number> = ref(0)\n    const minutes: Ref<string> = ref('')\n    const seconds: Ref<string> = ref('')\n\n    const shouldRemind = () => {\n      if (props.reminders.length > 0) {\n        if (props.reminders.includes(diff.value)) {\n          remind()\n        }\n      }\n    }\n\n    const setDisplay = () => {\n      // seconds since start\n      diff.value = props.duration - (((Date.now() - start.value) / 1000) | 0)\n\n      if (diff.value < 0 && !props.loop) {\n        clearInterval(timer.value)\n        clearInterval(counter.value)\n        return\n      }\n      shouldRemind()\n\n      // bitwise OR to handle parseInt\n      const minute = (diff.value / 60) | 0\n      const second = diff.value % 60 | 0\n\n      minutes.value = `${minute < 10 ? '0' + minute : minute}`\n      seconds.value = `${second < 10 ? '0' + second : second}`\n\n      display.value = `${minutes.value}:${seconds.value}`\n    }\n\n    const countdown = () => {\n      setDisplay()\n\n      if (diff.value <= 0 && props.loop) {\n        // add second to start at the full duration\n        // for instance 05:00, not 04:59\n        start.value = Date.now() + 1000\n      }\n    }\n\n    const idle = () => {\n      emit('idle')\n    }\n\n    const remind = () => {\n      emit('remind')\n    }\n\n    const setTimer = () => {\n      timer.value = window.setInterval(idle, props.duration * 1000)\n      counter.value = window.setInterval(countdown, 1000)\n    }\n\n    const clearTimer = (event: Event) => {\n      const clearEvent: {\n        type: string\n        key: string | undefined\n      } = {\n        type: event.type,\n        key: event instanceof KeyboardEvent ? event.key : undefined,\n      }\n      emit('refresh', clearEvent)\n      clearInterval(timer.value)\n      clearInterval(counter.value)\n      setDisplay()\n      start.value = Date.now()\n      diff.value = 0\n      setTimer()\n    }\n\n    onMounted(() => {\n      setTimeout(() => {\n        start.value = Date.now()\n        setDisplay()\n        nextTick(() => {\n          setTimer()\n          for (let i = props.events.length - 1; i >= 0; i -= 1) {\n            window.addEventListener(props.events[i], clearTimer)\n          }\n        })\n      }, props.wait * 1000)\n    })\n\n    onBeforeUnmount(() => {\n      clearInterval(timer.value)\n      clearInterval(counter.value)\n      for (let i = props.events.length - 1; i >= 0; i -= 1) {\n        window.removeEventListener(props.events[i], clearTimer)\n      }\n    })\n\n    return {\n      display,\n    }\n  },\n  render() {\n    return h(\n      'div',\n      {\n        class: 'v-idle',\n      },\n      this.display,\n    )\n  },\n})\n"],"names":["defineComponent","emits","props","duration","type","Number","default","events","Array","loop","Boolean","reminders","wait","setup","_a","emit","display","ref","timer","undefined","start","counter","diff","minutes","seconds","setDisplay","value","Date","now","clearInterval","length","includes","remind","minute","second","concat","countdown","idle","setTimer","window","setInterval","clearTimer","event","clearEvent","key","KeyboardEvent","onMounted","setTimeout","nextTick","i","addEventListener","onBeforeUnmount","removeEventListener","render","h","class","this"],"mappings":"2RAWeA,kBAAgB,CAC7BC,MAAO,CAAC,OAAQ,SAAU,WAC1BC,MAAO,CACLC,SAAU,CACRC,KAAMC,OAENC,QAAS,KAEXC,OAAQ,CACNH,KAAMI,MACNF,QAAS,WAAgB,MAAA,CAAC,YAAa,WAAW,GAEpDG,KAAM,CACJL,KAAMM,QACNJ,SAAS,GAEXK,UAAW,CACTP,KAAMI,MAGNF,QAAS,WAAgB,MAAA,EAAE,GAE7BM,KAAM,CACJR,KAAMC,OACNC,QAAS,IAGbO,MAAO,SAACX,EAAOY,GAAE,IAAAC,EAAID,EAAAC,KACbC,EAAuBC,MAAI,MAC3BC,EAAiCD,WAAIE,GACrCC,EAAqBH,MAAI,GACzBI,EAAmCJ,WAAIE,GACvCG,EAAoBL,MAAI,GACxBM,EAAuBN,MAAI,IAC3BO,EAAuBP,MAAI,IAU3BQ,EAAa,WAIjB,GAFAH,EAAKI,MAAQxB,EAAMC,WAAcwB,KAAKC,MAAQR,EAAMM,OAAS,IAAQ,GAEjEJ,EAAKI,MAAQ,IAAMxB,EAAMO,KAG3B,OAFAoB,cAAcX,EAAMQ,YACpBG,cAAcR,EAAQK,OAbpBxB,EAAMS,UAAUmB,OAAS,GACvB5B,EAAMS,UAAUoB,SAAST,EAAKI,QAChCM,IAiBJ,IAAMC,EAAUX,EAAKI,MAAQ,GAAM,EAC7BQ,EAASZ,EAAKI,MAAQ,GAAK,EAEjCH,EAAQG,MAAQ,UAAGO,EAAS,GAAK,IAAMA,EAASA,GAChDT,EAAQE,MAAQ,UAAGQ,EAAS,GAAK,IAAMA,EAASA,GAEhDlB,EAAQU,MAAQ,GAAAS,OAAGZ,EAAQG,MAAK,KAAAS,OAAIX,EAAQE,MAC9C,EAEMU,EAAY,WAChBX,IAEIH,EAAKI,OAAS,GAAKxB,EAAMO,OAG3BW,EAAMM,MAAQC,KAAKC,MAAQ,IAE/B,EAEMS,EAAO,WACXtB,EAAK,OACP,EAEMiB,EAAS,WACbjB,EAAK,SACP,EAEMuB,EAAW,WACfpB,EAAMQ,MAAQa,OAAOC,YAAYH,EAAuB,IAAjBnC,EAAMC,UAC7CkB,EAAQK,MAAQa,OAAOC,YAAYJ,EAAW,IAChD,EAEMK,EAAa,SAACC,GAClB,IAAMC,EAGF,CACFvC,KAAMsC,EAAMtC,KACZwC,IAAKF,aAAiBG,cAAgBH,EAAME,SAAMzB,GAEpDJ,EAAK,UAAW4B,GAChBd,cAAcX,EAAMQ,OACpBG,cAAcR,EAAQK,OACtBD,IACAL,EAAMM,MAAQC,KAAKC,MACnBN,EAAKI,MAAQ,EACbY,GACF,EAuBA,OArBAQ,EAAAA,WAAU,WACRC,YAAW,WACT3B,EAAMM,MAAQC,KAAKC,MACnBH,IACAuB,EAAAA,UAAS,WACPV,IACA,IAAK,IAAIW,EAAI/C,EAAMK,OAAOuB,OAAS,EAAGmB,GAAK,EAAGA,GAAK,EACjDV,OAAOW,iBAAiBhD,EAAMK,OAAO0C,GAAIR,EAE7C,GACF,GAAgB,IAAbvC,EAAMU,KACX,IAEAuC,EAAAA,iBAAgB,WACdtB,cAAcX,EAAMQ,OACpBG,cAAcR,EAAQK,OACtB,IAAK,IAAIuB,EAAI/C,EAAMK,OAAOuB,OAAS,EAAGmB,GAAK,EAAGA,GAAK,EACjDV,OAAOa,oBAAoBlD,EAAMK,OAAO0C,GAAIR,EAEhD,IAEO,CACLzB,QAAOA,EAEV,EACDqC,OAAM,WACJ,OAAOC,EAAAA,EACL,MACA,CACEC,MAAO,UAETC,KAAKxC,QAER"}